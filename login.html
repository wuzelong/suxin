<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>登录</title>
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link href="favicon.ico" rel="shortcut icon" />
    <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
    <script type="text/javascript" src="js/TGTool.js"></script>
    <link type="text/css" href="css/animatemin.css" rel="stylesheet"/>
    <link type="text/css" href="bootstrap-3.3.7-dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link type="text/css" href="css/model.css" rel="stylesheet"/>
    <link type="text/css" href="css/TGTool.css" rel="stylesheet"/>
    <link type="text/css" href="css/login.css" rel="stylesheet"/>
    <script type="text/javascript" src="bootstrap-3.3.7-dist/js/bootstrap.min.js"></script>

</head>
<body>
<!-- 搭建显示页面和登录表单 -->
<div id="container">
    <!-- logo信息 -->
    <div class="col-md-3 col-md-offset-9" style="top:8px;left: 128px">
        <p style="font-size:50px;color: white;font-family: 方正粗黑宋简体"><img src="images/宿心图标 -白.png"height="18%" width="18%">
            <B style="font-weight:800;position: absolute;top: 8px">&nbsp宿心</B></p>
    </div>

    <!-- 英文 -->
    <img class="center-block" src="images/英文.png"height="48px" width="344px">

    <!-- 登录表单 -->
    <div id="content" class="center-block animate__animated animate__zoomIn animate__delay-0.6s">
        <div class="form-group">
            <p style="font-family: 方正粗黑宋简体;color: rgb(51, 51, 51);position: relative;top: -24px">登录</p>
           <img src="images/line.png"style="position:relative;top: -48px">
        </div>
        <div id="i1"class="form-group"style="position: relative;top: -32px">
            <input onkeyup="checkI1()"type="text" class="form-control " id="user_login_name" name="loginid" placeholder="请输入电话号码"
            style="height: 40px;width: 280px;position:relative;top: -24px;left: 48px"/>
            <span id="helpBlock1" class="help-block"style="font-size: 15px;top: -24px;position:relative;display: none;font-family:宋体;">手机号格式错误</span>
        </div>

        <div id="i2"class="form-group"style="margin-top: -8px;color: #f4a261;position: relative;top: -32px">
            <input onkeyup="checkI2()"type="password" class="form-control" id="user_login_password" name="password" placeholder="请输入密码"
                   style="height: 40px;width: 280px;position:relative;left: 48px;top:8px"/>
            <br>
            <span id="helpBlock2" class="help-block"style="font-size: 15px;top: -32px;position:relative;display: none;font-family:宋体;">密码长度3-15</span>
        </div>

        <div id="i9"class="form-group"style="position: relative">
            <div class="row">
                <input onkeyup="checkI3()"type="text" class="form-control myinput"placeholder="请输入验证码"id="codeInput">
                <input type="button" value="获取验证码" id="codeBtn">
                <span id="helpBlock9" class="help-block"style="font-size: 15px;top: -80px;display:none;position:relative;font-family:宋体;">验证码错误！</span>
            </div>
        </div>
        <div id="i3"class="checkbox"style="position:relative;top:-176px;left:120px;font-size: 10px;color: #1B1B1B">
            <label>
                <input type="checkbox"> 记住密码
            </label>
        </div>
        <input type="button"id="user_login_btn" value="登  录"style="position: relative;top: -96px">

        <div id="i5"class="row"style="position: relative;top: -96px">
            <img onclick="coding()" src="images/qq1.png"style="position: relative;left: -20px">
            <img onclick="coding()" src="images/微信2.png"style="position: relative;left: 5px">
            <img onclick="coding()" src="images/微博图标.png"style="position: relative;left: 30px">
        </div>

        <div id="i6"class="row"style="position: relative;top: -88px;font-size: 15px">
            没有账号？<a href="register.html">点此注册</a>
        </div>
    </div>

</div>

<!--返回首页-->
<div class="backBox">
    <a href="index.html">
        <img src="images/黑箭头.png"height="16px"width="18px"><B>返回首页</B>
    </a>
</div>

<!--底部-->
<div class="bot">
    <div class="col-md-6 col-md-offset-4"style="left: 45px;top: 8px">隐私协议 | 用户协议 | 关于我们 | 我是房客 | 加入宿心 | 网站地图</div>
    <div class="col-md-6 col-md-offset-5"style="left: 45px;top: 10px">© 2020 jmu.com版权所有</div>
</div>

<!--右侧交互-->
<div class="rightBox">
    <ul>
        <li class="weixin">
            <div class="weixin-logo"></div>
        </li>
        <li class="app"style="background:url(images/意见反馈.png);background-size: 100% 100%;">
            <div class="app-logo"></div>
        </li>
        <li class="idea">
            <div class="idea-logo"></div>
        </li>
    </ul>
</div>
<script type="text/javascript">
    let tg = TGTool();
    var code;
    $("#codeBtn").on("click", function() {
        code=Math.floor(Math.random()*10000);
        tg.info('验证码：'+code);
    });
    (function(){
        var uid=getQueryVariable("phone");
        if(uid!=null&&""!=uid){
            $("#user_login_name").val(uid);
        }
    })();
    //获取url参数
    function getQueryVariable(variable)
    {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return pair[1];}
        }
        return(false);
    }
    //登录按钮
    $("#user_login_btn").on("click", function() {
        if(!checkI1()||!checkI2()||!checkI3())return;
        var id=$("#user_login_name").val();
        var pwd=$("#user_login_password").val();
        if(id=="")
            tg.warning("请输入电话号码！");
        else if(pwd=="")
            tg.warning("请输入密码！");
        else{
            //发送登录请求
            $.ajax({
                url:"login.php",
                type:"POST",
                data:{username:id,password:pwd},
                success:function (result) {
                    if(result==100){
                        tg.success("登录成功！");
                        sessionStorage.setItem("token",id)
                        setTimeout(function(){
                            window.location.href="index.html";
                        },3100);
                    }
                    else{
                        tg.error("用户名或密码错误！");
                    }
                }
            });
        }
    });
    function checkI1(){
        let phoneRule=/^1[0-9]{10}$/;
        var id=$("#user_login_name").val();
        if(!phoneRule.test(id)){
            $("#i1").removeClass('has-success').addClass('has-error');
            document.getElementById("helpBlock1").style.display="";
            document.getElementById("i2").style.marginTop="-34px";
            return false;
        }
        else{
            $("#i1").removeClass('has-error').addClass('has-success');
            document.getElementById("helpBlock1").style.display="none";
            document.getElementById("i2").style.marginTop="-8px";
            return true;
        }
    };
    function checkI2(){
        let reg=/^.{3,15}/;
        var pwd=$("#user_login_password").val();
        if(!reg.test(pwd)){
            $("#i2").removeClass('has-success').addClass('has-error');
            document.getElementById("helpBlock2").style.display="";
            document.getElementById("i3").style.top="-202px";
            document.getElementById("i9").style.top="-26px";
            document.getElementById("i5").style.top="-122px";
            document.getElementById("i6").style.top="-114px";
            document.getElementById("user_login_btn").style.top="-122px";
            return false;
        }
        else{
            $("#i2").removeClass('has-error').addClass('has-success');
            document.getElementById("helpBlock2").style.display="none";
            document.getElementById("i3").style.top="-176px";
            document.getElementById("i9").style.top="0px";
            document.getElementById("i5").style.top="-96px";
            document.getElementById("i6").style.top="-88px";
            document.getElementById("user_login_btn").style.top="-96px";
            return true;
        }
    };
    function checkI3(){
        var val=$("#codeInput").val();
        if(val!=code){
            $("#i9").removeClass('has-success').addClass('has-error');
            document.getElementById("helpBlock9").style.display="";
            document.getElementById("i3").style.top="-212px";
            document.getElementById("user_login_btn").style.top="-132px";
            document.getElementById("i5").style.top="-132px";
            document.getElementById("i6").style.top="-124px";
            return false;
        }
        else{
            $("#i9").removeClass('has-error').addClass('has-success');
            document.getElementById("helpBlock9").style.display="none";
            document.getElementById("i3").style.top="-176px";
            document.getElementById("user_login_btn").style.top="-96px";
            document.getElementById("i5").style.top="-96px";
            document.getElementById("i6").style.top="-88px";
            return true;
        }
    }
    function coding(){
        tg.info("开发中...");
    }
</script>
</body>
</html>